<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>ESP32 GPS 轨迹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        #mapContainer { width: 100%; height: 100vh; }
    </style>
    <script src="https://webapi.amap.com/maps?v=2.0&key=你的高德Key"></script>
</head>
<body>
<div id="mapContainer"></div>
<script>
async function fetchGPS() {
    try {
        const res = await fetch('/api/gps');
        const data = await res.json();
        return data.gps || [];
    } catch(e) {
        console.error("获取GPS失败", e);
        return [];
    }
}

async function initMap() {
    const gpsPoints = await fetchGPS();
    if (!gpsPoints.length) return alert("没有GPS数据");

    const center = [gpsPoints[0].lon, gpsPoints[0].lat];
    const map = new AMap.Map('mapContainer', {
        zoom: 14,
        center: center
    });

    const path = gpsPoints.map(p => [p.lon, p.lat]);

    new AMap.Polyline({
        map,
        path,
        borderWeight: 2,
        strokeColor: '#FF33FF',
        lineJoin: 'round',
        lineCap: 'round'
    });

    new AMap.Marker({ map, position: path[0], title: '起点' });
    new AMap.Marker({ map, position: path[path.length - 1], title: '终点' });
}

initMap();
</script>
</body>
</html>
